<!DOCTYPE html>
<html lang="en">
<head>
	<script type="text/javascript" src="js/_lib/jquery.js"></script>
	<script type="text/javascript" src="js/jquery-ui.js"></script>
	<script type="text/javascript" src="js/jquery.jstree.js"></script>
	<script type="text/javascript" src="js/_lib/jquery.cookie.js"></script>
	<script type="text/javascript" src="js/bootstrap.js"></script>
	<script type="text/javascript" src="js/bootstrap-dropdown.js"></script>
	<script type="text/javascript" src="js/knockout-2.3.0-min.js"></script>
	<script type="text/javascript" src="js/createJobReports.js"></script>
	<script type="text/javascript" src="js/plotgraphs.js"></script>
	<script src="js/lib/d3.v2.js"></script>
	<script src="js/nv.d3.js"></script>
	<script src="js/src/tooltip.js"></script>
	<script src="js/src/utils.js"></script>
	<script src="js/src/models/legend.js"></script>
	<script src="js/src/models/axis.js"></script>
	<script src="js/src/models/scatter.js"></script>
	<script src="js/src/models/line.js"></script>
	<script src="js/src/models/lineChart.js"></script>
	<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
	<link href="js/src/nv.d3.css" rel="stylesheet" type="text/css">
	<link href="css/jquery-ui.css" rel="stylesheet" type="text/css">
	<style type="text/css">
		.navbar .header-border {
			border-bottom:4px solid #E47911;
		}
		@media (min-width: 768px) {

			/* top row */
			.col{ 
    			margin-bottom: -99999px;
    			padding-bottom: 99999px;  
			}
			/* bottom row */
			.col-base{ 
    			margin-top: -15px; /* cut off top portion of bottom wells */
			}
			}

			@media (max-width: 767px) {
				.row-fluid.base{
    				display:none;
				}
			}
			.col-wrap{
    			overflow: hidden; 
			}
	</style>
</head>
<body>
	<!--Navigation Bar-->
	<div id="navigation">
	</div>
	<script>
		$(function(){
		  $("#navigation").load('header.html');
		  console.log(window.queryParams);
		  getGraphPlotScheme();
		  getJobStats();
		  getMonitoringStats();
	      ko.applyBindings(new graphReports());
	      getGraphsData();
	      createGroupTree();
	      createMonitoringTree();
	      hideGraphs();
	      hideMonitoringGraphs();
	      $("#autoRefresh").change(function(){
	      	if($("#autoRefresh").is(":checked")){
	      		var url = window.location.href;
	      		if(url.indexOf("autoRefresh")!=-1){
	      			url = url.replace("autoRefresh=false", "autoRefresh=true");
	      		} else {
	      			url = url + "&autoRefresh=true&interval=60000";
	      		}
	      		history.replaceState(null, null, url);
	      		location.reload();
	      	} else {
				var url = window.location.href;
	      		url = url.replace("autoRefresh=true", "autoRefresh=false");
	      		history.replaceState(null, null, url);	
	      		location.reload();
	      	}
	      });
	      $("#interval").change(function(){
	      	console.log("inside interval change")
	      	var url = window.location.href;
	      	url = url.replace(/interval=\d+/, "interval=" + $("#interval").val());
	      	history.replaceState(null, null, url);
	        location.reload();
	      })
	      var autoRefresh = getQueryParams("autoRefresh");
	      if(autoRefresh=="true"){
	      	var interval = getQueryParams("interval");
	      	$("#autoRefresh").prop("checked", true);
	      	$("#interval").removeAttr('disabled');
	      	$("#interval").val(interval);
	      	window.clearInterval();
	      	setInterval(function(){location.reload();}, interval);
	      } else {
	      	window.clearInterval();
	      	$("#autoRefresh").prop("checked", false);
	      	$("#interval").attr("disabled", "disabled");
	      }
	    });
	</script>
	<!--navigation bar ends-->
	<!--breadcrumbs make it dynamic-->
	<div class="row-fluid">
		<div class="span10">
		<ul class="breadcrumb">
  			<li><a href="index.htm">Home</a> <span class="divider">/</span></li>
  			<li><a href="jobsearch.html">Job Search</a> <span class="divider">/</span></li>
		</ul>
		</div>
		<div class="span2 pull-right">
			<label class="checkbox span7">
				<input type="checkbox" id="autoRefresh" value="">Auto Refresh
			</label>
			<select id="interval" class="span5" disabled="disabled">
				<option selected="true" value="60000">1 Min</option>
				<option value="300000">5 Mins</option>
				<option value="600000">10 Mins</option>
				<option value="900000">15 Mins</option>
			</select>
		</div>
	</div>
	<!--breadcrumbs end-->
	<!-- Graphs and Tree container-->
	<!-- <div class="row-fluid">
		
	</div> -->
	<div class="row-fluid">
		<div class="span12">
			<div class="span3">
				<div class="row-fluid col-wrap">
					<div class="span12 col well">
						<fieldset>
							<legend>Groups</legend>
							<div id="timerTree">
							</div>
						</fieldset>
					</div>
				</div>
				<div class="row-fluid base col-wrap">
				<!-- add a second row of wells or rounded corner divs immeadiately underneath-->
    				<div class="span12 col-base well"></div>
				</div>
				<!-- close row -->
				<div class="row-fluid col-wrap">
					<div class="span12 col well">
						<fieldset>
							<legend>Monitoring Agents</legend>
							<div id="monitoringTree">
							</div>
						</fieldset>
					</div>
				</div>
				<div class="row-fluid base col-wrap">
				<!-- add a second row of wells or rounded corner divs immeadiately underneath-->
    				<div class="span12 col-base well"></div>
				</div>
			</div>
			<div class="span9 well">
				<div class="span12" data-bind="foreach: jobGroups" id="timerGraphs">
					<div data-bind="attr: {'id': groupDivId}">
						<fieldset>
							<legend><span data-bind="text: groupName"></span></legend>
							<div class="span12" data-bind="foreach: timers">
								<div data-bind="attr:{'id':timerDivId}">
									<div class="row-fluid">
										<span class="label label-info pull-left" data-bind="text: timerName"></span></br>
<!-- 										<label class="pull-left" data-bind="text: timerName"></label>
 -->									</div>
									<div class="row-fluid">
										<div class="span2">
											<span class="label label-success pull-left">Count&nbsp;:&nbsp;</span>
											<p class="span6" data-bind="attr: {'id':countId}"></p>
										</div>
										<div class="span2">
											<span class="label label-warning pull-left">Skip&nbsp;:&nbsp;</span>
											<p class="span6" data-bind="attr: {'id':skipId}"></p>
										</div>
										<div class="span2">
											<span class="label label-important pull-left">Error&nbsp;:&nbsp;</span>
											<p class="span6" data-bind="attr: {'id':errorId}"></p>
										</div>
										<div class="span2">
											<span class="label label-important pull-left">Failure&nbsp;:&nbsp;</span>
											<p class="span6" data-bind="attr: {'id':failureId}"></p>
										</div>
									</div>
									<div class="row-fluid">
										<div class="span6" data-bind="attr:{'id':chartName1}">
											<svg style="height: 350px;min-height:350px"></svg>
											<div class="span10 offset1">
												<div data-bind="attr:{'id':sliderName1}"></div>
											</div>
										</div>
										<div class="span6" data-bind="attr:{'id':chartName2}">
											<svg style="height: 350px;min-height:350px"></svg>
											<div class="span10 offset1">
												<div data-bind="attr:{'id':sliderName2}"></div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</fieldset>
					</div>
				</div>
				<div class="span12" data-bind="foreach: monAgents" id="monGraphs">
					<div data-bind="attr: {'id': monAgentDivId}">
						<fieldset>
							<legend data-bind="text: agent"></legend>
							<div data-bind="foreach: resources">
								<div data-bind="attr: {'id':resourceDivId}">
									<div class="row-fluid">
										<label class="pull-left" data-bind="text: resourceName"></label>
									</div>
									<div class="row-fluid" data-bind="foreach: charts">
										<div class="row-fluid">
											<div class="span6" data-bind="attr:{'id':chartName1}">
												<svg style="height: 350px;min-height:350px"></svg>
												<div class="span10 offset1">
													<div data-bind="attr:{'id':sliderName1}"></div>
												</div>
											</div>
											<div class="span6" data-bind="attr:{'id':chartName2}">
												<svg style="height: 350px;min-height:350px"></svg>
												<div class="span10 offset1">
													<div data-bind="attr:{'id':sliderName2}"></div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</fieldset>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script type="text/javascript">
	var jobId = getQueryParams("jobId");
		$(".breadcrumb").append("<li><a href=\"jobdetails.html?&jobId=" + jobId + "\">Job Details</a> <span class=\"divider\">/</span></li>");
		$(".breadcrumb").append("<li><a href=\"#\">Job Graphs</a> <span class=\"divider\">/</span></li>");
	</script>
</body>
</html>