<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link href="js/src/nv.d3.css" rel="stylesheet" type="text/css">
<link href="css/nav.css" rel="stylesheet" type="text/css" />

<style>

body {
  overflow-y:scroll;
}

text {
  font: 12px sans-serif;
}

svg {
  display: block;
}
</style>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<script type="text/javascript" src="js/jquery-1.9.1.js"></script>
<script src="js/lib/d3.v2.js"></script>
<script src="js/nv.d3.js"></script>
<script src="js/src/tooltip.js"></script>
<script src="js/src/utils.js"></script>
<script src="js/src/models/legend.js"></script>
<script src="js/src/models/axis.js"></script>
<script src="js/src/models/scatter.js"></script>
<script src="js/src/models/line.js"></script>
<script src="js/src/models/lineChart.js"></script>
<script src="js/plotgraphs.js"></script>
<script src="js/getJobDetails.js"></script>
<script type="text/javascript">
    $(document).ready(function(){
    	var jobId = getQueryParams("jobid");
		$.ajax({
			url: "/loader-server/jobs/" + jobId + "/jobStats",
			type: "GET",
			contentType: "application/json",
			async: false,
			success: function(data){
				var groups = data;
				console.log(groups);
				window.groupCount = groups.length;
				window.timerLengths = new Array();
				//window.timersToPlot = {};
				window.timerUrls = new Array();
				for( var i=0; i<groups.length; i++){
					var groupJson = groups[i];
					var insertHtml = "<h3 class=\"collapsible\" id=\"section" + (i + 4) + "\">" + groupJson["groupName"] +  
					"<span></span><h3>" + 
					"<div id=\"section" + (i + 4) + "Container\" class=\"container\">";
					var timers = groupJson["timers"];
					window.timerLengths[i] = timers.length;
					for( var j=0; j<timers.length; j++){
						var timerName = timers[j]["name"];
						window.timerUrls.push("/loader-server/jobs/" + jobId + "/jobStats/groups/" + groupJson["groupName"] + "/timers/" + timerName + "/agents/combined") ;
						console.log("timer:" + timerName);
						var chartId = "chart" + i +j;
						console.log("chartId:" + chartId);
						insertHtml = insertHtml + "<div class=\"content\"><table width=\"100%\">" + "<tr><th colspan=\"2\">" + timerName + "</th></tr><tr><td width=\"50%\"><div id=\"" + chartId + "1\"><svg style=\"height: 250px\"></svg></div></td><td width=\"50%\"><div id=\"" + chartId + "2\"><svg style=\"height: 250 px\"></svg></div></td></table></div>";
						//insertHtml = insertHtml + "<div class=\"content\"><p>" + timerName + "</p>";

					}
					insertHtml = insertHtml + "</div>";
					
					$("#collapsibleMenu")
					.append(insertHtml);
				}
				console.log("success done");
			},
			error: function(err){
				console.log("Error");
			},
			complete: function(comp){
				console.log($('.container'));
				$('.container').slideUp();
				$('.collapsible').click(function(){
					var id = $(this).attr("id");
					console.log(id);
					$("#"+id+"Container").slideToggle();
				});
				console.log("timersToPlot:" +  window.timerUrls);
				window.stats = new Array();
				var cnt = 0;
				for (var k=0; k<window.groupCount; k++){
					window.stats[k] = new Array();
					for(var p=0;p<window.timerLengths[k];p++){
						returnTimerGraphs(window.timerUrls[cnt++], k,p);
					}
				}
				console.log("complete done");
			}
			});
        //collapsible management
    });
</script>
<title>Collapsible Menu</title>
<link href="css/collapsible.css" rel="stylesheet" type="text/css" />
</head>

<body>
<div id="header"></div>
<script>
	$(function(){
		$("#header").load('header.html');
	})
</script>
<div id="collapsibleMenu">
</div>
</body>
</html>
